<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Studio Roblox ‚Äî Pedido</title>
<style>
  :root{
    --bg:#0f1226; --card:#171a36; --text:#e9ecff; --muted:#aab0d6;
    --accent:#7c5cff; --accent2:#5a3dff;
  }
  body{margin:0;font-family:Arial,system-ui;background:var(--bg);color:var(--text)}
  .app{max-width:720px;margin:0 auto;padding:28px 18px}
  .card{background:var(--card);border-radius:14px;padding:18px;margin-bottom:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  h2{margin:0 0 10px}
  .page{display:none}
  .page.show{display:block}
  input, textarea{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(170,176,214,.25);background:#121431;color:#fff;outline:none}
  input::placeholder, textarea::placeholder{color:#8f95c7}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .btn{padding:10px 14px;border:none;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;font-weight:600;cursor:pointer}
  .btn-outline{padding:10px 14px;border:1px solid #aab0d6;border-radius:10px;background:transparent;color:#e9ecff;cursor:pointer}
  .progress{font-size:12px;color:#aab0d6;margin-bottom:8px}
  .center{text-align:center}

  /* Quadradinho relat√≥rios */
  .reports-toggle{
    position:fixed;right:16px;bottom:16px;width:36px;height:36px;
    background:#121431;border:1px solid #2a2d4f;border-radius:8px;
    display:flex;align-items:center;justify-content:center;cursor:pointer;
    box-shadow:0 6px 20px rgba(0,0,0,.35);font-size:18px;z-index:998;
  }

  /* Relat√≥rios */
  .report-item{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid #2a2d4f}
  .report-left{display:flex;align-items:center;gap:10px}
  .status-box{width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:6px;font-size:18px;background:#121431}
  .trash{cursor:pointer;font-size:18px}

  /* Modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:999}
  .modal-backdrop.show{display:flex}
  .modal{background:#171a36;color:#e9ecff;border-radius:12px;max-width:520px;width:90%;padding:18px}
  .modal h3{margin:0 0 10px}
  .modal .actions{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}
</style>
</head>
<body>
<div class="app">

  <!-- P√°gina inicial -->
  <section id="page-start" class="page show card">
    <div class="progress">1/5</div>
    <h2>Digite seu arroba</h2>
    <input id="inputHandle" type="text" placeholder="@seuarroba">
    <div class="actions"><button type="button" id="btnNextStart" class="btn">Avan√ßar ‚ûú</button></div>
    <div id="startError" style="display:none;color:#aab0d6">Digite um @ v√°lido (ex.: @enzogamer)</div>
  </section>

  <!-- Escolha -->
  <section id="page-choice" class="page card">
    <div class="progress">2/5</div>
    <h2>Escolha</h2>
    <div class="actions">
      <button type="button" id="btnChoosePersonalize" class="btn">Personalizar ‚ûú</button>
      <button type="button" id="btnChooseCreator" class="btn-outline">Escolha do Criador ‚ûú</button>
    </div>
  </section>

  <!-- Criador -->
  <section id="page-write-creator" class="page card">
    <div class="progress">3/5</div>
    <h2>Observa√ß√µes do Criador</h2>
    <textarea id="inputCreatorNotes" placeholder="Escreva suas observa√ß√µes..."></textarea>
    <div class="actions">
      <button type="button" id="btnBackChoice2" class="btn-outline">Voltar</button>
      <button type="button" id="btnNextWriteCreator" class="btn">Pr√≥xima: Nick ‚ûú</button>
    </div>
    <div id="creatorWriteError" style="display:none;color:#aab0d6">Obrigat√≥rio escrever algo</div>
  </section>

  <!-- Estilo -->
  <section id="page-style" class="page card">
    <div class="progress">3/5</div>
    <h2>Estilo</h2>
    <input id="inputStyle" type="text" placeholder="Ex.: urbano, realista, minimalista...">
    <div class="actions">
      <button type="button" id="btnBackChoice1" class="btn-outline">Voltar</button>
      <button type="button" id="btnNextStyle" class="btn">Pr√≥xima: Cen√°rio ‚ûú</button>
    </div>
  </section>

  <!-- Cen√°rio -->
  <section id="page-scenario" class="page card">
    <div class="progress">4/5</div>
    <h2>Cen√°rio</h2>
    <input id="inputScenario" type="text" placeholder="Ex.: praia, floresta, metr√¥...">
    <div class="actions">
      <button type="button" id="btnBackStyle" class="btn-outline">Voltar</button>
      <button type="button" id="btnNextScenario" class="btn">Pr√≥xima: Nick ‚ûú</button>
    </div>
  </section>

  <!-- Nick -->
  <section id="page-nick" class="page card">
    <div class="progress">5/5</div>
    <h2>Nick Roblox</h2>
    <input id="inputRobloxNick" type="text" placeholder="Seu nick do Roblox">
    <div class="actions">
      <button type="button" id="btnBackPrevNick" class="btn-outline">Voltar</button>
      <button type="button" id="btnNextNick" class="btn">Pr√≥xima: C√≥digo ‚ûú</button>
    </div>
  </section>

  <!-- C√≥digo -->
  <section id="page-code" class="page card">
    <h2>Digite seu c√≥digo</h2>
    <input id="inputCode" type="text" placeholder="C√≥digo">
    <div class="actions">
      <button type="button" id="btnBackNick" class="btn-outline">Voltar</button>
      <button type="button" id="btnFinish" class="btn">Finalizar ‚úî</button>
    </div>
    <div id="codeError" style="display:none;color:#aab0d6">C√≥digo inv√°lido ou j√° usado.</div>
  </section>

  <!-- Final -->
  <section id="page-done" class="page card center">
    <h2>Aguarde sua imagem no pv ‚úî</h2>
    <div class="actions center"><button type="button" id="btnDoneBack" class="btn-outline">Voltar ao in√≠cio</button></div>
  </section>

  <!-- Relat√≥rios acesso -->
  <section id="page-reports-access" class="page card">
    <h2>Acesso relat√≥rios</h2>
    <input id="inputReportsCode" type="password" placeholder="C√≥digo de acesso">
    <div class="actions">
      <button type="button" id="btnReportsBack" class="btn-outline">Voltar</button>
      <button type="button" id="btnReportsEnter" class="btn">Entrar ‚ûú</button>
    </div>
    <div id="reportsAccessError" style="display:none;color:#aab0d6">C√≥digo incorreto</div>
  </section>

  <!-- Relat√≥rios -->
  <section id="page-reports" class="page card">
    <h2>Relat√≥rios</h2>
    <div id="reportList"></div>
    <div class="actions">
      <button type="button" id="btnResetAll" class="btn-outline">Resetar todos</button>
      <button type="button" id="btnReportsHome" class="btn">Voltar</button>
    </div>
  </section>

</div>

<!-- Quadradinho no canto para abrir relat√≥rios -->
<div id="reportsToggle" class="reports-toggle" title="Relat√≥rios">‚ñ£</div>

<!-- Modal de detalhes -->
<div id="detailsModalBackdrop" class="modal-backdrop">
  <div class="modal">
    <h3>Detalhes do pedido</h3>
    <div id="detailsContent"></div>
    <div class="actions">
      <button type="button" id="btnCloseDetails" class="btn-outline">Fechar</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
  /* Estado */
  const state = {
    handle: '',
    path: 'personalize', // 'personalize' ou 'creator'
    creatorNotes: '',
    style: '',
    scenario: '',
    robloxNick: ''
  };

  function showPage(id){
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('show'));
    const el = document.getElementById(id);
    if(el) el.classList.add('show');
  }

  /* Banco em mem√≥ria */
  const pedidos = []; // {usuario, status:'pendente'|'pronto', tipo:'criador'|'personalizado', dados:{creatorNotes, estilo, cenario, nick}}
  const usedCodes = []; // c√≥digos j√° usados (√∫nicos)

  function addPedido(usuario, tipo, dados){
    const existente = pedidos.find(p=>p.usuario===usuario);
    if(existente) return false; // 1 pedido por usu√°rio
    pedidos.push({usuario, status:'pendente', tipo, dados: dados || {}});
    renderReports();
    return true;
  }

  function finalizarPedido(usuario, codigo){
    if(!isCodeValid(codigo)) return false;
    if(usedCodes.includes(codigo)) return false; // n√£o permite repetir
    const pendente = pedidos.find(p=>p.usuario===usuario && p.status==='pendente');
    if(pendente){
      pendente.status = 'pronto';
      usedCodes.push(codigo);
      renderReports();
      return true;
    }
    return false;
  }

  function isCodeValid(code){
    const s = String(code || '').trim();
    if(s.length < 5) return false;
    return s[0] === '1' && s[s.length-1] === '2' && s.slice(1, -1).includes('8');
  }

  function deletePedido(usuario){
    const idx = pedidos.findIndex(p=>p.usuario===usuario);
    if(idx >= 0){
      pedidos.splice(idx, 1);
      renderReports();
    }
  }

  function resetPedidos(){
    pedidos.splice(0, pedidos.length);
    usedCodes.splice(0, usedCodes.length);
    renderReports();
  }

  /* Modal */
  function openDetailsModal(html){
    document.getElementById('detailsContent').innerHTML = html;
    document.getElementById('detailsModalBackdrop').classList.add('show');
  }
  document.getElementById('btnCloseDetails').onclick = ()=>{
    document.getElementById('detailsModalBackdrop').classList.remove('show');
  };

  /* Render relat√≥rios */
  function renderReports(){
    const list = document.getElementById('reportList');
    list.innerHTML = '';
    if(pedidos.length === 0){
      list.innerHTML = '<p style="color:#aab0d6">Nenhum pedido no momento.</p>';
      return;
    }
    pedidos.forEach(p=>{
      const item = document.createElement('div');
      item.className = 'report-item';

      const left = document.createElement('div');
      left.className = 'report-left';

      const statusBox = document.createElement('div');
      statusBox.className = 'status-box';
      statusBox.textContent = p.status === 'pronto' ? 'üü¢' : 'üü°';
      statusBox.title = 'Status';

      const label = document.createElement('div');
      label.textContent = p.usuario;

      left.appendChild(statusBox);
      left.appendChild(label);

      const actionsRight = document.createElement('div');
      actionsRight.style.display = 'flex';
      actionsRight.style.gap = '10px';
      actionsRight.style.alignItems = 'center';

      const detailsBtn = document.createElement('button');
      detailsBtn.className = 'btn-outline';
      detailsBtn.type = 'button';
      detailsBtn.textContent = 'Ver detalhes';
      detailsBtn.onclick = ()=>{
        const d = p.dados || {};
        const tipo = p.tipo === 'criador' ? 'Escolha do Criador' : 'Personalizado';
        const html =
          `<p><strong>Tipo:</strong> ${tipo}</p>` +
          (p.tipo === 'criador'
            ? `<p><strong>Observa√ß√µes:</strong> ${d.creatorNotes || '-'}</p>`
            : `<p><strong>Estilo:</strong> ${d.estilo || '-'}</p>
               <p><strong>Cen√°rio:</strong> ${d.cenario || '-'}</p>`) +
          `<p><strong>Nick:</strong> ${d.nick || '-'}</p>`;
        openDetailsModal(html);
      };

      const trash = document.createElement('button');
      trash.className = 'btn-outline';
      trash.type = 'button';
      trash.title = 'Excluir pedido';
      trash.textContent = 'üóëÔ∏è';
      trash.onclick = ()=> deletePedido(p.usuario);

      actionsRight.appendChild(detailsBtn);
      actionsRight.appendChild(trash);

      item.appendChild(left);
      item.appendChild(actionsRight);
      list.appendChild(item);
    });
  }

  /* Navega√ß√£o */

  // In√≠cio -> Escolha
  document.getElementById('btnNextStart').onclick = ()=>{
    const h = document.getElementById('inputHandle').value.trim();
    if(h.startsWith('@') && h.length > 2){
      state.handle = h;
      document.getElementById('startError').style.display = 'none';
      showPage('page-choice');
    } else {
      document.getElementById('startError').style.display = 'block';
    }
  };

  // Escolha
  document.getElementById('btnChoosePersonalize').onclick = ()=>{
    state.path = 'personalize';
    showPage('page-style'); // direto para Estilo
  };
  document.getElementById('btnChooseCreator').onclick = ()=>{
    state.path = 'creator';
    showPage('page-write-creator'); // exige observa√ß√µes
  };

  // Criador: escrever observa√ß√µes
  document.getElementById('btnBackChoice2').onclick = ()=> showPage('page-choice');
  document.getElementById('btnNextWriteCreator').onclick = ()=>{
    const notes = document.getElementById('inputCreatorNotes').value.trim();
    if(!notes){
      document.getElementById('creatorWriteError').style.display = 'block';
      return;
    }
    document.getElementById('creatorWriteError').style.display = 'none';
    state.creatorNotes = notes;
    showPage('page-nick');
  };

  // Estilo/Cen√°rio
  document.getElementById('btnBackChoice1').onclick = ()=> showPage('page-choice');
  document.getElementById('btnNextStyle').onclick = ()=>{
    state.style = document.getElementById('inputStyle').value.trim();
    showPage('page-scenario');
  };
  document.getElementById('btnBackStyle').onclick = ()=> showPage('page-style');
  document.getElementById('btnNextScenario').onclick = ()=>{
    state.scenario = document.getElementById('inputScenario').value.trim();
    showPage('page-nick');
  };

  // Nick -> C√≥digo
  document.getElementById('btnBackPrevNick').onclick = ()=>{
    if(state.path === 'creator') showPage('page-write-creator');
    else showPage('page-scenario');
  };
  document.getElementById('btnNextNick').onclick = ()=>{
    state.robloxNick = document.getElementById('inputRobloxNick').value.trim();
    if(state.robloxNick.length === 0){
      alert('Digite seu nick do Roblox.');
      return;
    }
    const created = addPedido(state.handle, state.path === 'creator' ? 'criador' : 'personalizado', {
      creatorNotes: state.creatorNotes,
      estilo: state.style,
      cenario: state.scenario,
      nick: state.robloxNick
    });
    if(!created){
      alert('Voc√™ j√° possui um pedido ativo.');
    }
    showPage('page-code');
  };

  // C√≥digo final
  document.getElementById('btnBackNick').onclick = ()=> showPage('page-nick');
  document.getElementById('btnFinish').onclick = ()=>{
    const code = document.getElementById('inputCode').value.trim();
    const ok = finalizarPedido(state.handle, code);
    if(ok){
      document.getElementById('codeError').style.display = 'none';
      showPage('page-done');
    } else {
      document.getElementById('codeError').style.display = 'block';
    }
  };
  document.getElementById('btnDoneBack').onclick = ()=> showPage('page-start');

  // Quadradinho de relat√≥rios
  document.getElementById('reportsToggle').onclick = ()=> showPage('page-reports-access');

  // Acesso aos relat√≥rios (c√≥digo 2093)
  document.getElementById('btnReportsBack').onclick = ()=> showPage('page-start');
  document.getElementById('btnReportsEnter').onclick = ()=>{
    const code = document.getElementById('inputReportsCode').value.trim();
    if(code === '2093'){
      document.getElementById('reportsAccessError').style.display = 'none';
      renderReports();
      showPage('page-reports');
    } else {
      document.getElementById('reportsAccessError').style.display = 'block';
    }
  };

  // Relat√≥rios: reset e voltar
  document.getElementById('btnResetAll').onclick = resetPedidos;
  document.getElementById('btnReportsHome').onclick = ()=> showPage('page-start');
});
</script>
</body>
</html>
